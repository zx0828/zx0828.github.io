(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{406:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("ul",[s("li",[s("a",{attrs:{href:"#jvm%E4%B8%AD%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D"}},[t._v("jvm中对象分配")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AF%B9%E8%B1%A1%E5%9C%A8%E6%A0%88%E4%B8%8A%E5%88%86%E9%85%8D"}},[t._v("对象在栈上分配")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E9%BB%98%E8%AE%A4%E6%98%AF%E5%BC%80%E5%90%AF%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90%E6%A0%87%E9%87%8F%E6%9B%BF%E6%8D%A2%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0-xxdoescapeanalysis--xxeliminateallocations"}},[t._v("默认是开启逃逸分析，标量替换的。设置参数：-XX:+DoEscapeAnalysis -XX:+EliminateAllocations")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AF%B9%E8%B1%A1%E5%9C%A8%E5%A0%86%E4%B8%8A%E5%88%86%E9%85%8D-eden%E4%B8%8Esurvivor%E5%8C%BA%E9%BB%98%E8%AE%A4811minor%E4%B8%8Eold%E6%98%AF12%E5%A6%82%E6%9E%9C%E6%AF%94%E4%BE%8B%E6%9C%89%E5%8F%98%E5%8C%96%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0-xx-useadaptivesizepolicy"}},[t._v("对象在堆上分配 Eden与Survivor区默认8:1:1,minor与old是1:2,如果比例有变化可以设置参数-XX:-UseAdaptiveSizePolicy")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0--xxprintgcdetails--xms256m--xmx256m"}},[t._v("设置参数 -XX:+PrintGCDetails -Xms256m -Xmx256m")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#-xxprintgcdetails--xxpretenuresizethreshold10000-10kb-%E4%BD%BF%E7%94%A8-xxuseserialgc-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"}},[t._v("-XX:+PrintGCDetails -XX:PretenureSizeThreshold=10000 (10kb) 使用-XX:+UseSerialGC 垃圾回收")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%AF%B9%E8%B1%A1%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"}},[t._v("对象回收算法")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%8F%AF%E8%BE%BE%E6%80%A7"}},[t._v("可达性")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E5%99%A8"}},[t._v("引用计数器")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E6%97%A0%E7%94%A8%E7%B1%BB%E5%9F%BA%E6%9C%AC%E4%B8%8A%E5%BE%88%E9%9A%BE%E6%BB%A1%E8%B6%B3%E4%B8%80%E8%88%AC%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E8%83%BD%E6%BB%A1%E8%B6%B3"}},[t._v("无用类（基本上很难满足，一般自定义的类加载器能满足）")])])]),t._v(" "),s("h1",{attrs:{id:"jvm中对象分配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm中对象分配"}},[t._v("#")]),t._v(" jvm中对象分配")]),t._v(" "),s("p",[t._v("对象在内存中存储的布局可以分为3块区域："),s("strong",[t._v("对象头（Header）、 实例数据（Instance Data）和对齐填充（Padding）")]),t._v(" ，第一部分用于存储对象自身的运行时数据，mark word， 如"),s("strong",[t._v("哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时 间戳")]),t._v("等。对象头的另外一部分是类型指针,klass,类元信息，即对象指向它的类元数据的指针")]),t._v(" "),s("h1",{attrs:{id:"对象在栈上分配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象在栈上分配"}},[t._v("#")]),t._v(" 对象在栈上分配")]),t._v(" "),s("ul",[s("li",[t._v("逃逸分析：在方法里面创建对象，如果返回给外部引用，那么就是逃逸到外部了，如果没有逃逸，就会进行栈上分配，")]),t._v(" "),s("li",[t._v("标量替换，如果没有逃逸，在栈分配时候，可以分解对象为多个独立局部变量，直接在栈上分配，避免创建完整的对象")])]),t._v(" "),s("h2",{attrs:{id:"默认是开启逃逸分析-标量替换的。设置参数-xx-doescapeanalysis-xx-eliminateallocations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#默认是开启逃逸分析-标量替换的。设置参数-xx-doescapeanalysis-xx-eliminateallocations"}},[t._v("#")]),t._v(" 默认是开启逃逸分析，标量替换的。设置参数：-XX:+DoEscapeAnalysis -XX:+EliminateAllocations")]),t._v(" "),s("div",{staticClass:"language-JAVA{.line_numbers} extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('public class TestAllotOnStack {\n    public static void main(String[] args) {\n        long start = System.currentTimeMillis();\n        for (int i = 0; i < 1000000000; i++) {\n            allotOnStack();\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(end-start);\n    }\n    public static void allotOnStack() {\n        User user= new User();\n        user.setAge(1);\n        user.setName("wangtu");\n    }\n}\n')])])]),s("p",[t._v("打开-XX:+PrintGC,就能发现在关闭逃逸分析后，出现大量的GC操作")]),t._v(" "),s("h1",{attrs:{id:"对象在堆上分配-eden与survivor区默认8-1-1-minor与old是1-2-如果比例有变化可以设置参数-xx-useadaptivesizepolicy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象在堆上分配-eden与survivor区默认8-1-1-minor与old是1-2-如果比例有变化可以设置参数-xx-useadaptivesizepolicy"}},[t._v("#")]),t._v(" 对象在堆上分配 Eden与Survivor区默认8:1:1,minor与old是1:2,如果比例有变化可以设置参数-XX:-UseAdaptiveSizePolicy")]),t._v(" "),s("ul",[s("li",[t._v("如果对象大小能在eden存放就放，放不下直接进入oldEden")])]),t._v(" "),s("h1",{attrs:{id:"设置参数-xx-printgcdetails-xms256m-xmx256m"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置参数-xx-printgcdetails-xms256m-xmx256m"}},[t._v("#")]),t._v(" 设置参数 -XX:+PrintGCDetails -Xms256m -Xmx256m")]),t._v(" "),s("div",{staticClass:"language-java {.line_numbers} extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestGc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" allocation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" allocation1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("当分配的60m大小，eden刚好放下，如果在放一个5m,导致把对象从eden分配到old中，如下图\n"),s("img",{attrs:{src:t.$withBase("/img/backend/gcallocation.png"),alt:"gc后内存分配"}})]),t._v(" "),s("ul",[s("li",[t._v("在Parnew和serial这两种垃圾回收机制。")])]),t._v(" "),s("h2",{attrs:{id:"xx-printgcdetails-xx-pretenuresizethreshold-10000-10kb-使用-xx-useserialgc-垃圾回收"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xx-printgcdetails-xx-pretenuresizethreshold-10000-10kb-使用-xx-useserialgc-垃圾回收"}},[t._v("#")]),t._v(" -XX:+PrintGCDetails -XX:PretenureSizeThreshold=10000 (10kb) 使用-XX:+UseSerialGC 垃圾回收")]),t._v(" "),s("div",{staticClass:"language-java {.line_numbers} extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestGc")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" allocation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("设置后直接分配到oldeden中，如下图\n"),s("img",{attrs:{src:t.$withBase("/img/backend/gcoldallocation.png"),alt:"直接在old内存分配"}})]),t._v(" "),s("h1",{attrs:{id:"对象回收算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象回收算法"}},[t._v("#")]),t._v(" 对象回收算法")]),t._v(" "),s("h2",{attrs:{id:"可达性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可达性"}},[t._v("#")]),t._v(" 可达性")]),t._v(" "),s("h2",{attrs:{id:"引用计数器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引用计数器"}},[t._v("#")]),t._v(" 引用计数器")]),t._v(" "),s("p",[t._v("将GCroot作为起点，线程本地变量，静态变量，本地方法栈的变量。强引用不会回收，弱引用会回收，一般放一些缓存，可有可无。")]),t._v(" "),s("h1",{attrs:{id:"无用类-基本上很难满足-一般自定义的类加载器能满足"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#无用类-基本上很难满足-一般自定义的类加载器能满足"}},[t._v("#")]),t._v(" 无用类（基本上很难满足，一般自定义的类加载器能满足）")]),t._v(" "),s("p",[t._v("类信息在本地方法区，在里面的无用类被被fullgc回收，判断无用类的三个条件")]),t._v(" "),s("ul",[s("li",[t._v("该类所有对象实例已经回收")]),t._v(" "),s("li",[t._v("加载该类的classloader 已经回收")]),t._v(" "),s("li",[t._v("该类对应的class 对象 没有任何地方被引用，就是无法反射访问该类的方法。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);